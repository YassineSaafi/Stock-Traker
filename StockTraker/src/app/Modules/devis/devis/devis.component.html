<div class="container">
  <!-- Bouton pour ouvrir le modal -->
  <button class="btn btn-primary" (click)="openModal(modalContent)">Créer un devis</button>

  <!-- Modèle Bootstrap 5 -->
  <ng-template #modalContent let-modal>
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modal-basic-title">Créer un devis</h5>
          <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
          <!-- Formulaire de création de devis -->
          <form [formGroup]="factureForm" (ngSubmit)="genererFacture()">
            <div class="mb-3">
              <label for="nomclient" class="form-label">Choisir un client</label>
              <select formControlName="nomclient" id="nomclient" class="form-select" required>
                <option *ngFor="let client of clients" [value]="client._id">{{ client.nom }}</option>
              </select>
            </div>
        
            <div class="mb-3">
              <label for="produitSelect" class="form-label">Choisir un produit</label>
              <select formControlName="produitSelect" id="produitSelect" class="form-select" required>
                <option *ngFor="let produit of produits" [value]="produit._id">{{ produit.nom }}</option>
              </select>
            </div>
        
            <div class="mb-3">
              <label for="quantite" class="form-label">Quantité</label>
              <input type="number" formControlName="quantite" id="quantite" class="form-control" required>
            </div>
        
            <button type="button" class="btn btn-primary mb-3" (click)="ajouterProduit()">Ajouter Produit</button>
        
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Référence</th>
                  <th>Nom</th>
                  <th>Quantité</th>
                  <th>Prix Unitaire</th>
                  <th>Prix Total</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of items">
                  <td>{{ item.ref }}</td>
                  <td>{{ item.nom }}</td>
                  <td>{{ item.qte }}</td>
                  <td>{{ item.prix | currency:'EUR':'symbol':'1.2-2' }}</td>
                  <td>{{ item.prix * item.qte | currency:'EUR':'symbol':'1.2-2' }}</td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="4">Total</td>
                  <td>{{ calculerTotal() | currency:'EUR':'symbol':'1.2-2' }}</td>
                </tr>
              </tfoot>
            </table>
        
            <button type="submit" class="btn btn-success">Générer Devis</button>
          </form>
        </div>
      </div>
    </div>
  </ng-template>

  <h2>Devis</h2>
  <table class="table table-striped">
    <thead>
      <tr>
        <th scope="col">Numéro</th>
        <th scope="col">Client</th>
        <th scope="col">Date</th>
        <th scope="col">Produits</th>
        <th scope="col">Somme</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let devis of devisList">
        <td>{{ devis.num }}</td>
        <td>{{ getClientName(devis.client) }}</td>
        <td>{{ devis.date | date: 'dd/MM/yyyy' }}</td>
        <td>
          <ul>
            <li *ngFor="let produit of devis.produits">
              {{ produit.nom }}
            </li>
          </ul>
        </td>
        <td>{{ devis.somme | currency:'EUR':'symbol':'1.2-2' }}</td>
        
        <td>
          <button class="btn btn-primary btn-sm" (click)="modifierDevis(devis, modalContent)"><i class="fa fa-pencil"></i></button>

          <button class="btn btn-danger btn-sm" (click)="supprimerDevis(devis._id)"><i class="fa fa-trash"></i></button>
          <button class="btn btn-secondary btn-sm" (click)="imprimerDevis(devis._id)"><i class="fa fa-print"></i></button>
        </td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="devisList.length === 0" class="text-center">
    <p>Aucun devis disponible pour le moment.</p>
  </div>
</div>

<div *ngFor="let devis of devisList" [id]="'devisDetails-' + devis._id" style="display: none;">
  <div class="company-logo">
    <img src="assets/images/logo.jpg" alt="Logo de la société">
  </div>
  <h3>Devis Numéro {{ devis.num }}</h3>
  <div class="client-details">
    <h4>{{ getClientName(devis.client) }}</h4>
    <!-- Ajoutez d'autres détails du client si nécessaire -->
  </div>
  
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Référence</th>
        <th>Désignation</th>
        <th>Qte</th>
        <th>Prix Unitaire HTVA</th>
        <th>Prix Total HTVA</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let produit of devis.produits">
        <td>{{ produit.ref }}</td>
        <td>{{ produit.nom }}</td>
        <td>{{ produit.qte }}</td>
        <td>{{ produit.prix | currency:'EUR':'symbol':'1.2-2' }}</td>
        <td>{{ produit.prix * produit.qte | currency:'EUR':'symbol':'1.2-2' }}</td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="4">Total HT</td>
        <td>{{ devis.somme | currency:'EUR':'symbol':'1.2-2' }}</td>
      </tr>
      <!-- Ajoutez des lignes pour la TVA ou d'autres détails si nécessaire -->
    </tfoot>
  </table>

  <!-- Ajoutez d'autres détails du devis si nécessaire -->
</div>
